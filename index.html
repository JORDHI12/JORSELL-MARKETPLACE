<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Jorsell ‚Äî DigiMarket (Fixed Full) + Afiliator & Withdraw</title>
  <meta name="description" content="Jorsell - Marketplace Produk Digital (Supabase Powered SPA) - with affiliate & withdraw features" />
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    :root{
      --brand:#5D3A9B;
      --brand-2:#5D3A9B;
      --bg:#f6f7fb;
      --card:#ffffff;
      --muted:#282828;
      --text:#000000;
      --radius:12px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased;font-family:Inter,system-ui,Arial}
    .app{max-width:420px;margin:0 auto;min-height:100vh;display:flex;flex-direction:column;position:relative}
    header.app-header{background:linear-gradient(180deg,var(--brand),var(--brand-2));color:white;padding:12px 14px;padding-bottom:18px;border-bottom-left-radius:18px;border-bottom-right-radius:18px}
    .header-top{display:flex;align-items:center;justify-content:space-between}
    .logo{display:flex;align-items:center;gap:10px;font-weight:700}
    .logo .badge{width:40px;height:40px;border-radius:10px;display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,0.12)}
    .search-row{display:flex;gap:8px;margin-top:10px}
    .search{flex:1;display:flex;align-items:center;background:rgba(255,255,255,0.12);padding:8px;border-radius:10px}
    .search input{border:0;background:transparent;outline:none;color:#FAF3E0;width:100%}
    .icon-btn{width:40px;height:40px;border-radius:10px;background:rgba(255,255,255,0.12);display:flex;align-items:center;justify-content:center;color:white;cursor:pointer}
    main{padding:12px;padding-bottom:100px;flex:1}
    .card{background:var(--card);border-radius:12px;padding:12px;box-shadow:0 6px 14px rgba(15,23,42,0.06);margin-bottom:12px}
    .carousel{height:140px;border-radius:12px;overflow:hidden;position:relative}
    .carousel img{Width:100%;height:100%;object-fit:cover;display:block}
    .carousel .dots{position:absolute;left:12px;bottom:8px;display:flex;gap:6px}
    .dot{width:8px;height:8px;border-radius:8px;background:rgba(255,255,255,0.6)}
    .dot.active{background:white}
    .cats{display:grid;grid-template-columns:repeat(5,1fr);gap:8px;margin-top:12px}
    .cat{background:white;border-radius:10px;padding:8px;text-align:center;font-size:12px;box-shadow:0 4px 10px rgba(15,23,42,0.04);cursor:pointer}
    .cat img{width:36px;height:36px;margin:0 auto;border-radius:8px;background:linear-gradient(180deg,#fbf5ff,#f7f0ff);display:block}
    .products{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:10px}
    .product{background:var(--card);border-radius:12px;padding:8px;cursor:pointer;display:flex;flex-direction:column}
    .p-thumb{height:110px;border-radius:10px;background:linear-gradient(180deg,#f8f4ff,#fff);display:flex;align-items:center;justify-content:center;font-weight:700;margin-bottom:8px}
    .p-title{font-size:14px;font-weight:700}
    .p-meta{font-size:12px;color:var(--muted);margin-top:6px}
    .p-actions{display:flex;gap:8px;margin-top:auto}
    .btn{flex:1;background:var(--brand);color:white;border:0;padding:8px;border-radius:10px;cursor:pointer}
    .btn-outline{flex:1;border:1px solid rgba(0,0,0,0.06);padding:8px;border-radius:10px;background:transparent}
    .page{display:none}
    .page.active{display:block}
    .bottom-nav{position:fixed;left:50%;transform:translateX(-50%);bottom:12px;width:420px;max-width:96%;height:72px;background:white;border-radius:16px;display:flex;align-items:center;justify-content:space-around;box-shadow:0 10px 30px rgba(15,23,42,0.12);z-index:999}
    .nav-item{flex:1;text-align:center;font-size:12px;color:var(--muted);cursor:pointer;display:flex;flex-direction:column;align-items:center;justify-content:center}
    .nav-item.active{color:var(--brand);font-weight:700}
    .profile-row{display:flex;gap:12px;align-items:center}
    .avatar{width:64px;height:64px;border-radius:14px;background:linear-gradient(180deg,var(--brand),var(--brand-2));display:flex;align-items:center;justify-content:center;color:white;font-weight:700}
    @media(min-width:900px){ .app{margin-top:18px;border-radius:18px;box-shadow:0 12px 40px rgba(15,23,42,0.08);overflow:hidden} .bottom-nav{width:420px} }
    .small{font-size:13px;color:var(--muted)}
    input,textarea,select{padding:8px;border-radius:8px;border:1px solid rgba(0,0,0,0.06);width:100%}
    .hidden{display:none}
    /* withdraw & affiliate helpers */
    .muted-note{font-size:13px;color:var(--muted);margin-top:8px}
    .link-box{display:flex;gap:8px;margin-top:8px}
    .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:100px;background:#111;color:white;padding:8px 12px;border-radius:8px;opacity:0.95;z-index:9999}
    #profile .card h4 {
  margin-bottom: 6px;
  font-weight: 700;
  color: var(--text);
}

#profile .card {
  box-shadow: 0 4px 10px rgba(15,23,42,0.05);
}

#profile label {
  font-size: 13px;
  font-weight: 600;
  color: var(--muted);
}

#profile input, #profile select, #profile textarea {
  width: 100%;
}

  </style>
</head>
<body>
  <div class="app" id="app">
    <header class="app-header">
      <div class="header-top">
        <div class="logo">
          <div class="badge">J</div>
          <div>
            <div style="font-weight:700">Jorsell</div>
            <div style="font-size:12px;opacity:0.9">Marketplace Digital</div>
          </div>
        </div>
        <div style="display:flex;gap:8px">
          <div class="icon-btn" id="btn-wishlist" title="Notifikasi">üîî</div>
          <div class="icon-btn" id="btn-cart-top" title="Keranjang">üõí</div>
        </div>
      </div>

      <div class="search-row">
        <div class="search">
          <span style="margin-right:8px">‚åï</span>
          <input id="search-input" placeholder="Cari produk, template, ebook..." />
        </div>
        <div class="icon-btn" id="btn-search-go">Go</div>
      </div>
    </header>

    <main>
<!-- NOTIFICATIONS POPUP -->
<div id="notif-popup" class="card hidden" 
     style="position:absolute;top:70px;right:10px;z-index:999;
            width:300px;max-height:380px;overflow:auto;
            box-shadow:0 10px 20px rgba(0,0,0,0.15)">
  <h4>Notifikasi</h4>
  <div id="notif-list" class="small">Belum ada notifikasi</div>
</div>

      <!-- LOGIN -->
<section id="auth" class="page card active">
  <div style="display:flex;justify-content:space-between;align-items:center;gap:12px">
    <div>
      <h2>Masuk ke Akun</h2>
      <div class="small">Akses jual & beli produk digital</div>
    </div>
  </div>

  <div style="margin-top:12px;display:grid;gap:8px">
    <input id="auth-email" type="email" placeholder="Email" required />
    <input id="auth-pass" type="password" placeholder="Password" required />
    <div style="display:flex;gap:8px">
      <button id="btn-login" class="btn">Login</button>
      <button id="btn-show-register" class="btn-outline">Daftar</button>
    </div>
    <button id="btn-google" class="btn-outline">Login dengan Google</button>
    <div id="auth-note" class="small" style="color:var(--muted)"></div>
  </div>
</section>

<!-- REGISTER -->
<section id="register" class="page card">
  <h2>Daftar Akun Baru</h2>
  <div class="small">Bergabung di marketplace Jorsell dan mulai jual / beli produk digital</div>

  <div style="margin-top:12px;display:grid;gap:8px">
    <input id="reg-name" type="text" placeholder="Nama Lengkap" required />
    <input id="reg-email" type="email" placeholder="Email" required />
    <input id="reg-pass" type="password" placeholder="Password (min 6 karakter)" required />
    <div style="display:flex;gap:8px">
      <button id="btn-register" class="btn">Daftar</button>
      <button id="btn-show-login" class="btn-outline">Sudah punya akun?</button>
    </div>
    <div id="reg-note" class="small" style="color:var(--muted)"></div>
  </div>
</section>

      <!-- HOME -->
      <section id="home" class="page card">
        <div class="carousel" id="carousel">
          <img id="carousel-img" src="" alt="banner">
          <div class="dots" id="carousel-dots"></div>
        </div>

        <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px">
          <strong>Kategori</strong>
          <a href="#" id="see-all-cats" class="small">Lihat semua</a>
        </div>
        <div class="cats" id="home-cats"></div>

        <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px">
          <strong>Rekomendasi untukmu</strong>
          <div class="small">Berdasarkan produk terbaru</div>
        </div>
        <div class="products" id="home-products"></div>
      </section>

<!-- CATEGORIES -->
<section id="categories" class="page card">
  <div style="display:flex;justify-content:space-between;align-items:center">
    <h3>Kategori Produk Digital</h3>
    <div class="small">Pilih kategori untuk melihat produk</div>
  </div>

  <!-- kolom pencarian -->
  <div style="margin-top:12px;margin-bottom:8px">
    <input id="category-search" type="text" placeholder="üîç Cari kategori..." />
  </div>

  <!-- daftar kategori -->
 <section id="kategori-page">
  <h2>Kategori Produk Digital</h2>
  <div id="kategori-container" class="kategori-grid"></div>
</section>

<section id="produk-container" class="produk-grid"></section>

<!-- Upload form (hanya untuk seller login) -->
<section id="upload-produk">
  <h2>Tambah Produk Digital</h2>
  <input id="nama" placeholder="Nama produk" />
  <textarea id="deskripsi" placeholder="Deskripsi"></textarea>
  <input id="harga" type="number" placeholder="Harga" />
  <input id="gambar_url" placeholder="URL Gambar" />
  <input id="file_url" placeholder="URL File Digital" />
  <input id="kategori_id" type="number" placeholder="ID Kategori" />
  <button id="uploadBtn">Upload Produk</button>
</section>

<script type="module">
  import { uploadProduk } from "./produk.js";

  document.getElementById("uploadBtn").addEventListener("click", async () => {
    const dataProduk = {
      nama: document.getElementById("nama").value,
      deskripsi: document.getElementById("deskripsi").value,
      harga: parseFloat(document.getElementById("harga").value),
      gambar_url: document.getElementById("gambar_url").value,
      file_url: document.getElementById("file_url").value,
      kategori_id: parseInt(document.getElementById("kategori_id").value),
    };
    await uploadProduk(dataProduk);
  });
</script>



      <!-- CART -->
      <section id="cart" class="page card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <h3>Keranjang</h3>
          <div class="small">{<span id="cart-count">0</span>} item</div>
        </div>
        <div id="cart-list" style="margin-top:12px"></div>
        <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px">
          <div class="small">Total</div>
          <div id="cart-total" style="font-weight:700">Rp0</div>
        </div>
        <div style="margin-top:12px"><button id="btn-checkout" class="btn">Checkout</button></div>
      </section>

      <!-- CHAT -->
      <section id="chat" class="page card">
        <h3>Chat</h3>
        <div id="chat-box" style="margin-top:8px;max-height:360px;overflow:auto;padding:8px;border-radius:8px;border:1px solid rgba(0,0,0,0.04)"></div>
        <div style="display:flex;gap:8px;margin-top:8px">
          <input id="chat-input" placeholder="Ketik pesan..." />
          <button id="btn-send-chat" class="btn">Kirim</button>
        </div>
      </section>

      <!-- PROFILE -->
<!-- PROFILE -->
<section id="profile" class="page card">

  <!-- Info pengguna -->
  <div class="card" style="margin-bottom:12px">
    <div class="profile-row" style="align-items:center;gap:16px">
      <div class="avatar" id="profile-avatar">U</div>
      <div style="flex:1">
        <div id="profile-name" style="font-weight:700;font-size:16px">-</div>
        <div id="profile-email" class="small">-</div>
      </div>
      <div style="text-align:right">
        <div class="small">Saldo</div>
        <div id="profile-balance" style="font-weight:700;font-size:15px">Rp0</div>
      </div>
    </div>
    <div style="margin-top:12px;text-align:right">
      <button id="btn-logout" class="btn" style="background:#ef4444;width:100%">Logout</button>
    </div>
  </div>

  <!-- Upload Produk -->
  <div class="card" style="margin-bottom:12px">
    <h4>Upload Produk Baru</h4>
    <div style="display:grid;gap:6px;margin-top:8px">
      <label>File</label><input type="file" id="file-upload" />
      <label>Judul</label><input id="prod-title" />
      <label>Kategori</label><input id="prod-cat" placeholder="Ebook, Template..." />
      <label>Harga</label><input id="prod-price" type="number" />
      <label>Deskripsi</label><textarea id="prod-desc"></textarea>
      <button id="submit-product" class="btn" style="margin-top:8px">Upload & Simpan</button>
      <div id="upload-note" class="small" style="color:var(--muted)"></div>
    </div>
  </div>

  <!-- Rekening -->
  <div class="card" style="margin-bottom:12px">
    <h4>Rekening Saya</h4>
    <div class="small">Simpan rekening bank atau e-wallet untuk penarikan otomatis.</div>

    <div style="display:grid;gap:6px;margin-top:8px">
      <label>Tipe Akun</label>
      <select id="account-type">
        <option value="bank">Bank</option>
        <option value="ewallet">E-Wallet</option>
      </select>

      <label>Nama Bank / E-Wallet</label>
      <select id="account-name"></select>

      <label>Nomor Rekening / E-Wallet</label>
      <input id="account-number" placeholder="Contoh: 1234567890" />

      <div style="display:flex;gap:8px;margin-top:8px">
        <button id="btn-save-account" class="btn" style="flex:1">Simpan</button>
        <button id="btn-clear-account" class="btn-outline" style="flex:1">Hapus</button>
      </div>
      <div id="save-account-note" class="muted-note"></div>
    </div>
  </div>

  <!-- Afiliator -->
  <div class="card" style="margin-bottom:12px">
    <h4>Afiliasi</h4>
    <div class="small">Bagikan link produk untuk dapat komisi.</div>
    <div class="link-box" style="margin-top:8px">
      <input id="affiliate-link" readonly placeholder="Login untuk membuat link afiliasi" />
      <button id="btn-copy-aff" class="btn-outline">Salin</button>
    </div>
    <div id="affiliate-note" class="muted-note">Link berisi ?ref=USERID</div>
    <div style="margin-top:8px">
      <button id="btn-open-aff-stats" class="btn-outline" style="width:100%">Lihat Statistik Afiliasi</button>
      <div id="aff-stats" class="small muted-note" style="margin-top:8px"></div>
    </div>
  </div>

  <!-- Penarikan -->
  <div class="card">
    <h4>Penarikan Saldo</h4>
    <div class="small">Tarik saldo ke rekening atau e-wallet.</div>
    <div style="display:grid;gap:6px;margin-top:8px">
      <label>Jumlah (Rp)</label><input id="withdraw-amount" type="number" placeholder="50000" />
      <label>Metode</label>
      <select id="withdraw-method">
        <option value="bank">Bank Transfer</option>
        <option value="gopay">Gopay</option>
        <option value="ovo">OVO</option>
      </select>
      <label>Tujuan</label><input id="withdraw-destination" placeholder="1234567890" />
      <div style="display:flex;gap:8px;margin-top:8px">
        <button id="btn-request-withdraw" class="btn" style="flex:1">Kirim</button>
        <button id="btn-load-withdraws" class="btn-outline" style="flex:1">Riwayat</button>
      </div>
      <div id="withdraw-note" class="muted-note"></div>
      <div id="withdraw-list" style="margin-top:8px"></div>
    </div>
  </div>

</section>

    </main>

    <footer style="padding:8px 12px;text-align:center;color:var(--muted)">¬© <span id="year"></span> Jorsell</footer>

    <!-- bottom nav always visible -->
    <nav class="bottom-nav" id="bottom-nav">
      <div class="nav-item" data-page="home">üè†<div>Beranda</div></div>
      <div class="nav-item" data-page="categories">üóÇÔ∏è<div>Kategori</div></div>
      <div class="nav-item" data-page="cart">üõí<div>Keranjang</div></div>
      <div class="nav-item" data-page="chat">üí¨<div>Chat</div></div>
      <div class="nav-item" data-page="profile">üë§<div>Profil</div></div>
    </nav>
  </div>
  
  <script type="module" src="script.js"></script>
<script type="module">
  import { initNavbar } from "./navbar.js";
  initNavbar();
</script>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
<script src="chat.js"></script>

</body>
</html>


